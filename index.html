<!doctype html>
<html>
  <body>
    <h2>Tutor Bot (Level1 + Level2)</h2>

    <div id="chat" style="border:1px solid #ccc;padding:10px;max-width:700px;height:300px;overflow:auto"></div>

    <input id="q" placeholder="Ask a question..." style="width:60%" />
    <button onclick="send()">Send</button>

    <hr>
    <h4>Upload notes (PDF / .txt) â†’ click Upload then wait for success</h4>
    <input id="files" type="file" multiple />
    <button onclick="upload()">Upload</button>
    <div id="uploadStatus"></div>

    <script>
      async function send() {
        const q = document.getElementById("q").value;
        if (!q) return;
        addMessage("You", q);
        const res = await fetch('/chat', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({question: q})
        });
        const data = await res.json();
        addMessage("Bot", data.answer);
      }
      function addMessage(who, text) {
        const d = document.getElementById("chat");
        d.innerHTML += `<p><b>${who}:</b> ${text}</p>`;
        d.scrollTop = d.scrollHeight;
      }

      async function upload() {
        const input = document.getElementById('files');
        const files = input.files;
        if (!files.length) return alert('Choose files');
        const fd = new FormData();
        for (let f of files) fd.append('files', f);
        document.getElementById('uploadStatus').innerText = 'Uploading...';
        const res = await fetch('/ingest', { method: 'POST', body: fd });
        const data = await res.json();
        document.getElementById('uploadStatus').innerText = JSON.stringify(data);
      }
    </script>
  </body>
</html>
